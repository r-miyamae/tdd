## 動作する綺麗なコード

- 開発が予測可能になる
- コードが伝えようとしていることを余すことなく受け取れる
- ユーザを快適にする
- チームメイトとの信頼感駅
- 書いていて気持ち良い

## ルール

- 自動化されたテストが失敗した時のみ、新しいコードを書く
- 重複を除去する

## 技術的影響

- 有機的に設計を進められるようになる
- テストを書くようになる
- 小さな変更に迅速に応答する開発環境を備えなくてはならなくなる
- 凝集度が高く結合度が低いたくさんの部品で構成された設計を行うようになる

## 第一部 多国籍通貨

## 1, 2章

### 仮実装

- ベタ書きの値をまず使い、実装が進むにつれ変数に置き換えていく

### 明白な実装

- すぐに頭の中の実装をコードに落とす
- 頭で設計ができているうちは明白な実装で進めて、テストが落ちたら仮実装に変えてテストを通すようにする

### 三角測量

- 成功するテストと失敗するテストの二点からコードを観測する
- コードを一般化できるのは二つ以上の実例がある時だけ
  - プロダクトコードとテストコード間の重複はカウントしない

## 3章、4章、5章

- valueオブジェクト
  - この本でいうDollarオブジェクト
  - **コンストラクタで設定したインスタンス変数の値が変わってはならない**
  - 別名参照(aliasing)を気にしなくて良くなる
    - 同じオブジェクトを参照しているものの一つを変更するともう片方も意図せず変更されるやつ
  - **操作は全て新しいオブジェクトを返す**
  - **equalsメソッドを実装する**
- TDDのリスク
  - そもそもテストが正当でなかったら何も検証できていない
    - リスクを受け入れ前に進み、失敗した時に何が必要だったか考える
  - TDDのサイクルフェーズ
    1. テストを書く
    2. コンパイラを通す
    3. テストを走らせ、失敗を確認する
    4. テストを通す
    5. 重複を排除する
  - 各フェーズは価値観が異なる
    - 最初の3つのフェーズはなるべく早く通過する
      - 新しい機能がどの状態にあるのかわかるため
      - そこにいくまではどのような罪を犯してもよい
      - 速度が設計よりも重要

## 6章、7章、8章、9章

- 頭の中にある悩みをテストとして表現する
- ↑が通るようにコードを修正する
- さらなる設計は本当に必要になる時まで先延ばしにする
- **Factory Methodパターン**
  - オブジェクト作成に柔軟性を持たせる
  - コンストラクタの代わりにメソッドでオブジェクトを作成する
- TDDとは歩幅を調節して進んでいくもの
  - 正しい歩幅はわからない

## 10章、11章、12章

- テストがあることでテストが通れば正しいと言う検証ができる
  - 検討が早くなる
  - とりあえずやってみればいい
- レッドバーの状態で新たにテストを作成するのは避けたい
  - レッドバーが出る前の状態に戻してテストを追加するのが手堅い方法
- 削除することで振る舞いに関する自身が減らないのであればテストを削除する
- 仮実装をすることでテストを通す
- 大きいテストを分割して進み具合がわかる小さいテストを作成する

## 13章

- interfaceのメソッドはpublicでないといけない(Java)
- クラスの明示的なチェックはポリモーフィズムに置き換えるべき
  - 同じメソッドをクラスごとに定義して意識せず呼び出せるようにする

## 14章

- 言語の仕様を確認するためのテストを書く
- 意図せず見つかったバグがあった場合再現できるテストを書いて修正する

## 15章

- コンパイラを使って実装を進めることもできる
  - 落ちたところを修正していく

## 16章

- テストを書くときには読者のことを考えるのが何よりも大切

## 17章

- ツールは変更や間違いを見逃さない
- TDDのテストは以下のテストの代替にはならない
  - パフォーマンステスト
  - 負荷テスト
  - ユーザビリティテスト
- ステートメントカバレッジ
  - 網羅率
  - 上げるにはテストを多く書くか、プログラムをシンプルにするか
- 欠陥挿入
  - プロダクトコードの任意の行の意味合いを変えたら、テストは失敗しなければならない

### 最後の振り返り

- テストを綺麗に機能させる3つのアプローチ
  - 仮実装
  - 三角測量
  - 明白な実装
- テストとコードの間の重複除去が、設計を駆動する
- テストの間のギャップを制御する能力
  - 路面が滑りやすいならグリップを増し、路面が良いなら速く
